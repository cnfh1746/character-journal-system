# 🎨 新布局设计说明

## 📋 设计概述

**核心理念：** 精简主面板 + 独立设置窗口（标签页式）

### 现状问题
- ❌ 主面板过长，需要滚动很久
- ❌ 9个大section混在一起
- ❌ 每次调整设置都要翻半天

### 新设计方案
- ✅ 主面板只保留：开关 + 设置按钮 + 状态显示
- ✅ 点击"打开设置"弹出独立窗口
- ✅ 设置窗口使用6个标签页分类

---

## 🎯 主面板布局（精简版）

```
┌─────────────────────────────────────┐
│ 📖 角色日志系统                     │
│ [简介说明]                          │
├─────────────────────────────────────┤
│ ☑ 启用角色日志系统                  │
│                                     │
│ [⚙️ 打开设置面板]  <-- 唯一按钮     │
├─────────────────────────────────────┤
│ 📊 状态信息                         │
│ • 功能状态: ✓ 已启用                │
│ • 世界书: CharacterJournal-123      │
│ • 对话长度: 245 楼                  │
│ • 跟踪角色数: 3                     │
│                                     │
│ 📊 各角色进度：                     │
│ • Alice: 200/245 楼 (82%)          │
│ • Bob: 245/245 楼 (100%)           │
│ • Carol: 150/245 楼 (61%)          │
└─────────────────────────────────────┘
```

**优势：**
- 不需要滚动
- 一眼看清状态
- 操作只需1次点击

---

## 🗂️ 设置窗口布局（标签页式）

### 标签页结构

```
┌─────────────────────────────────────────────────────┐
│ ⚙️ 角色日志系统 - 设置              [−] [×]        │
├─────────────────────────────────────────────────────┤
│ [基础设置] [角色管理] [日志配置] [API设置] [高级选项] [操作面板] │
├─────────────────────────────────────────────────────┤
│                                                     │
│          （当前标签的设置内容）                      │
│                                                     │
│                                                     │
├─────────────────────────────────────────────────────┤
│                [💾 保存设置] [关闭]                 │
└─────────────────────────────────────────────────────┘
```

---

## 📑 各标签页内容

### 1️⃣ 基础设置
- 世界书目标（角色主/专用）
- 专用世界书名称
- 角色检测模式（AI/手动）
- 启用自动更新
- 更新阈值

### 2️⃣ 角色管理
- **自动检测的角色显示**（角色徽章列表）
- 手动指定角色
- 排除名单
- 自动排除用户
- 读取世界书开关
- **智能过滤设置**
  - 启用出场次数过滤
  - 最小出场次数

### 3️⃣ 日志配置
- **日志生成**
  - 日志生成提示词（大文本框）
- **自动精炼**
  - 启用自动精炼
  - 精炼阈值
  - 精炼提示词（大文本框）

### 4️⃣ API设置
- API地址
- API密钥
- 模型名称 + [拉取模型]按钮
- 最大Token数
- [测试连接]按钮
- 连接状态显示

### 5️⃣ 高级选项
- **世界书条目设置**
  - 关键词模板
  - 插入位置
  - 条目顺序
  - 深度

### 6️⃣ 操作面板
- **操作按钮组**
  - [🔄 手动更新日志]
  - [📦 批量更新指定范围]
  - [🗜️ 手动精炼所有日志]
  - [🗑️ 清空所有日志条目]
- **状态信息显示**
  - 当前状态详情
  - 各角色进度

---

## 🎨 视觉特性

### 1. 标签页导航
```css
┌──────────┬──────────┬──────────┐
│ 基础设置 │ 角色管理 │ 日志配置 │  ← 激活态：深色背景
└──────────┴──────────┴──────────┘
```

### 2. 窗口特性
- **可拖拽** - 拖动标题栏移动窗口
- **可最小化** - 最小化到右下角
- **响应式** - 900px宽，最高85vh
- **滚动优化** - 内容区独立滚动

### 3. 颜色方案
- 主色调：`#4a90e2` (蓝色)
- 成功：`#27ae60` (绿色)
- 警告：`#f39c12` (橙色)
- 危险：`#e74c3c` (红色)

---

## 💡 用户体验流程

### 场景1：首次设置
1. 打开扩展设置
2. 看到精简面板 → 勾选"启用"
3. 点击"打开设置面板"
4. 依次配置：基础→角色→API
5. 点击"保存设置"
6. 关闭窗口，回到主面板

### 场景2：日常使用
1. 打开扩展设置
2. 查看状态 → 3个角色，进度正常
3. **无需任何操作**（自动更新已启用）
4. 关闭设置

### 场景3：手动更新
1. 打开扩展设置
2. 点击"打开设置面板"
3. 切换到"操作面板"标签
4. 点击"手动更新日志"或"批量更新"
5. 等待完成
6. 查看状态

---

## 📐 技术实现要点

### HTML结构
```html
<!-- 主面板：极简 -->
<div id="character_journal_settings">
  <div>简介</div>
  <div>启用开关</div>
  <button id="cj_open_settings">打开设置</button>
  <div>状态显示</div>
</div>

<!-- 设置窗口：独立modal -->
<div id="cj_settings_modal" class="modal">
  <div class="modal-content">
    <div class="tabs">...</div>
    <div class="tab-contents">...</div>
  </div>
</div>
```

### JavaScript逻辑
```javascript
// 打开设置窗口
$('#cj_open_settings').on('click', () => {
  $('#cj_settings_modal').fadeIn();
  initModalDragAndMinimize();
});

// 标签页切换
$('.character-journal-tab').on('click', function() {
  const tab = $(this).data('tab');
  
  // 激活标签
  $('.character-journal-tab').removeClass('active');
  $(this).addClass('active');
  
  // 显示内容
  $('.character-journal-tab-content').hide();
  $(`.character-journal-tab-content[data-tab="${tab}"]`).show();
});

// 保存设置
$('#cj_save_settings_modal').on('click', () => {
  saveSettings();
  toastr.success('设置已保存');
});
```

### CSS样式
```css
/* 标签页 */
.character-journal-tabs {
  display: flex;
  border-bottom: 2px solid #ddd;
}

.character-journal-tab {
  padding: 12px 20px;
  background: #f5f5f5;
  border: none;
  cursor: pointer;
}

.character-journal-tab.active {
  background: #4a90e2;
  color: white;
}

/* 标签内容 */
.character-journal-tab-content {
  padding: 20px;
}
```

---

## ✅ 优势总结

### vs 旧布局
| 对比项 | 旧布局 | 新布局 |
|--------|--------|--------|
| 主面板长度 | 需要滚动5-6屏 | 只占1屏 |
| 查找设置 | 滚动搜索 | 点击标签立即定位 |
| 视觉干扰 | 所有设置都显示 | 按需显示 |
| 操作效率 | 3-5次滚动 | 1次点击 |

### 用户反馈预期
- ✅ "终于不用滚动了！"
- ✅ "找设置变快了"
- ✅ "看起来更专业"
- ✅ "和酒馆其他扩展一致"

---

## 🚀 下一步

### 需要实现的功能
1. **标签页切换逻辑** - JS事件处理
2. **窗口拖拽功能** - 已有基础代码
3. **窗口最小化** - 缩小到右下角
4. **保存设置按钮** - 放在窗口底部
5. **关闭窗口** - 保存当前标签状态

### 需要补充的HTML
当前文件被截断，需要补充：
- 高级选项标签的剩余内容
- 操作面板标签（完整）
- 窗口底部按钮组

---

## 💬 等待确认

**这个布局方案可以吗？**
- ✅ 同意：我立即完成完整代码
- ⚠️ 需要调整：告诉我哪里需要改
- ❌ 不满意：说说你的想法

一旦确认，我会：
1. 补全HTML文件
2. 更新CSS样式
3. 编写JS逻辑
4. 测试所有功能
